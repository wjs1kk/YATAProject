<?xml version="1.0" encoding="UTF-8"?>
 <!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itwillbs.yata.mapper.ReviewMapper">
	<select id="selectReview"
		resultType="com.itwillbs.yata.vo.ReviewVO">
		SELECT member_name -- 작성자
		, review_content -- 내용
		, review_star -- 별점
		FROM review
		ORDER BY review_idx DESC
		LIMIT 3;
	</select>

	<!-- 리뷰 작성 -->
	<insert id="insertReview">
		<selectKey keyProperty="review_idx" resultType="int" order="BEFORE">
			SELECT IFNULL(MAX(review_idx), 1) FROM review
		</selectKey>
		INSERT INTO review 
					value (
					   #{review_idx} + 1
					  ,#{res_id}
					  ,#{member_email}
					  ,#{member_name}
					  ,#{review_title}
					  ,#{review_content}
					  ,CURRENT_TIMESTAMP()
					  ,#{review_star}
					  ,#{review_place}
					)
	</insert>					
	
	<!-- 나의 리뷰 select -->
	<select id="selectMyReview" resultType="com.itwillbs.yata.vo.ReviewVO">
	 	SELECT *
 	 	  FROM review
 		 WHERE member_email 
 		 IN (SELECT member_email FROM member WHERE member_email = #{member_email}) ORDER BY res_id DESC;
	</select>
	
	<!-- 나의 리뷰 개수 -->
	<select id="selectMyReviewCount" resultType="Integer">
		SELECT COUNT(member_email)
		  FROM review
		 WHERE member_email = #{member_email}
	</select>
	<!-- rent2 리뷰 표시 -->
	<select id="listReview" resultType="com.itwillbs.yata.vo.ReviewVO" parameterType="string">
		SELECT    review_idx
				, res_id
				, member_email
				, member_name
				, review_title
				, review_content
				, review_updateDate
				, review_star
				, review_place
			
  		  FROM review
 		  WHERE review_place = #{place}
  		 ORDER BY review_idx DESC
  		 LIMIT 10
	</select>
	
	<select id="selectResId" parameterType="int">
		SELECT res_id
		  FROM review
		WHERE member_email = #{member_email}
		  AND res_id = #{res_id}
		LIMIT 1;
	</select>
</mapper>